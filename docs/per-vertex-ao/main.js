(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{0:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(28);t.regl=r(),t.propBinder=function(e){return function(t){return e.prop(t)}}},112:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1);t.createSampleCollection=function(e,t){var n=1-(t=Math.max(Math.min(t||0,1),0)),o=e.positions,i=e.normals,c=e.indices,l=o.length/3,s=c.length/3,a={perVertex:Array.from({length:l}).map(function(e){return[]}),all:[]};if(!o||!i||!c)return a;for(var u,v=[r.vec3.create(),r.vec3.create(),r.vec3.create()],f=[r.vec3.create(),r.vec3.create(),r.vec3.create()],p=r.vec3.create(),m=r.vec3.create(),h=r.vec3.create(),d=0;d<s;d++){for(r.vec3.copyFromOffset(h,c,3*d),u=0;u<3;u++)r.vec3.copyFromOffset(v[u],o,3*h[u]),r.vec3.copyFromOffset(f[u],i,3*h[u]);for(r.vec3.add(p,v[0],v[1]),r.vec3.add(p,p,v[2]),r.vec3.scale(p,p,1/3),r.vec3.add(m,f[0],f[1]),r.vec3.add(m,m,f[2]),r.vec3.normalize(m,m),u=0;u<3;u++){var S={position:r.vec3.create(),normal:r.vec3.create()};r.vec3.scale(S.position,v[u],n),r.vec3.scaleAndAdd(S.position,S.position,p,t),r.vec3.scale(S.normal,f[u],n),r.vec3.scaleAndAdd(S.normal,S.normal,m,t),r.vec3.normalize(S.normal,S.normal),a.perVertex[h[0]].push(S),a.perVertex[h[1]].push(S),a.perVertex[h[2]].push(S),a.all.push(S)}}return a}},113:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function c(e){try{s(r.next(e))}catch(e){i(e)}}function l(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(c,l)}s((r=r.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var n,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(o=(o=c.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),c=n(0),l=n(22),s=n(115),a=n(120);t.renderSamples=function(e,t,n){return r(this,void 0,void 0,function(){var r,u,v,f,p,m,h,d,S,x,z,g,C,b,w,V;return o(this,function(o){for(n=Object.assign({near:.2,far:7,fov:.45*Math.PI,sampleSize:8,contrast:1},n||{}),2048,r=l.fbo(2048),u=t.length,v=Math.floor(2048/n.sampleSize),f=Math.pow(2048/n.sampleSize,2),p=Math.ceil(u/f),m={viewport:{x:0,y:0,width:n.sampleSize,height:n.sampleSize},model:i.mat4.create(),view:i.mat4.create(),projection:i.mat4.perspective(i.mat4.create(),n.fov,1,n.near,n.far),positions:c.regl.buffer(e.positions),indices:c.regl.elements(e.indices),nearPlane:n.near,farPlane:n.far,contrast:n.contrast,framebuffer:r},h=i.vec3.create(),d=new Float32Array(u),S=0,x=u,z=0;z<p;){for(c.regl.clear({color:[0,0,0,0],depth:1,framebuffer:r}),g=Math.min(x,f),C=S;C<S+g;)b=t[C],i.vec3.add(h,b.position,b.normal),i.mat4.lookAt(m.view,b.position,h,i.vec3.UP),m.viewport.x=C%v*n.sampleSize,m.viewport.y=Math.floor(C/v)*n.sampleSize,a.renderDepth(m),C++;for(w=s.reduceSamples(r,n.sampleSize,g,n.contrast),V=0;V<g;V++)d[S+V]=w[V];S+=g,x-=g,z++}return r.destroy(),[2,d]})})}},114:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.waitForNextFrame=function(){return new Promise(function(e){requestAnimationFrame(e)})}},115:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),o=n(22),i={2:n(116),4:n(117),8:n(118)};t.reduceSamples=function(e,t,c,l){var s,a=e.width;if(a!==e.height||(s=a,Math.log2(s)%1!=0))throw new Error("Invalid dimensions of the source!");var u=i[t];if(!u)throw new Error("Invalid sampleSize, no matching shader found!");var v=a/t,f=o.fbo(v),p=new Float32Array(c);return f.use(function(t){r.regl({vert:n(119),frag:u,attributes:{position:[-1,-1,1,-1,1,1,-1,-1,1,1,-1,1]},uniforms:{contrast:l,source:e,size:[v,v]},count:6})();for(var o,i,s=r.regl.read(),a=0;a<c;a++)o=a%v,i=Math.floor(a/v)*v+o,p[a]=s[4*i]/255}),f.destroy(),p}},116:function(e,t){e.exports="precision highp float;\n\nvec4 sumCorners(sampler2D tex, vec2 minCellUV, vec2 cellSizeUV) {\n\treturn  texture2D(tex, minCellUV + cellSizeUV * vec2(0, 0)) +\n\t\t\ttexture2D(tex, minCellUV + cellSizeUV * vec2(1, 0)) +\n\t\t\ttexture2D(tex, minCellUV + cellSizeUV * vec2(1, 1)) +\n\t\t\ttexture2D(tex, minCellUV + cellSizeUV * vec2(0, 1));\n}\n\nprecision highp float;\n\nfloat colorToFloat(const vec4 value)\n{\n  const vec4 bitSh = vec4(1.0/(256.0*256.0*256.0), 1.0/(256.0*256.0), 1.0/256.0, 1.0);\n  return(dot(value, bitSh));\n}\n\nprecision highp float;\n#define GLSLIFY 1\nuniform sampler2D source;\nuniform vec2 size;\nuniform float contrast;\n\nvoid main() {\n\tvec2 pixelCenter = gl_FragCoord.xy / size;\n\tvec2 pixelSize = vec2(1) / size;\n\tvec2 sourcePixelSize = pixelSize * 0.5;\n\n\tvec2 startUV = pixelCenter - pixelSize * 0.5 + sourcePixelSize * 0.5;\n\tfloat ao = sumCorners(source, startUV, sourcePixelSize).r / 4.0;\n\n\tgl_FragColor = vec4(pow(ao, contrast), 0, 0, 1);\n}\n"},117:function(e,t){e.exports="precision highp float;\n\nvec4 sumCorners(sampler2D tex, vec2 minCellUV, vec2 cellSizeUV) {\n\treturn  texture2D(tex, minCellUV + cellSizeUV * vec2(0, 0)) +\n\t\t\ttexture2D(tex, minCellUV + cellSizeUV * vec2(1, 0)) +\n\t\t\ttexture2D(tex, minCellUV + cellSizeUV * vec2(1, 1)) +\n\t\t\ttexture2D(tex, minCellUV + cellSizeUV * vec2(0, 1));\n}\n\nprecision highp float;\n\nfloat colorToFloat(const vec4 value)\n{\n  const vec4 bitSh = vec4(1.0/(256.0*256.0*256.0), 1.0/(256.0*256.0), 1.0/256.0, 1.0);\n  return(dot(value, bitSh));\n}\n\nprecision highp float;\n#define GLSLIFY 1\nuniform sampler2D source;\nuniform vec2 size;\nuniform float contrast;\n\nvoid main() {\n\tvec2 pixelCenter = gl_FragCoord.xy / size;\n\tvec2 pixelSize = vec2(1) / size;\n\tvec2 sourcePixelSize = pixelSize * 0.25;\n\tvec2 sourceCellSize = sourcePixelSize * 2.0;\n\n\tvec2 startUV = pixelCenter - pixelSize * 0.5 + sourcePixelSize * 0.5;\n\n\tfloat ao = \t(sumCorners(source, startUV + sourceCellSize * vec2(0, 0), sourcePixelSize) +\n\t\t\t\tsumCorners(source, startUV + sourceCellSize * vec2(1, 0), sourcePixelSize) +\n\t\t\t\tsumCorners(source, startUV + sourceCellSize * vec2(1, 1), sourcePixelSize) +\n\t\t\t\tsumCorners(source, startUV + sourceCellSize * vec2(0, 1), sourcePixelSize)).r / 16.0;\n\n\tgl_FragColor = vec4(pow(ao, contrast), 0, 0, 1);\n}\n"},118:function(e,t){e.exports="precision highp float;\n\nvec4 sumCorners(sampler2D tex, vec2 minCellUV, vec2 cellSizeUV) {\n\treturn  texture2D(tex, minCellUV + cellSizeUV * vec2(0, 0)) +\n\t\t\ttexture2D(tex, minCellUV + cellSizeUV * vec2(1, 0)) +\n\t\t\ttexture2D(tex, minCellUV + cellSizeUV * vec2(1, 1)) +\n\t\t\ttexture2D(tex, minCellUV + cellSizeUV * vec2(0, 1));\n}\n\nprecision highp float;\n\nfloat colorToFloat(const vec4 value)\n{\n  const vec4 bitSh = vec4(1.0/(256.0*256.0*256.0), 1.0/(256.0*256.0), 1.0/256.0, 1.0);\n  return(dot(value, bitSh));\n}\n\nprecision highp float;\n#define GLSLIFY 1\nuniform sampler2D source;\nuniform vec2 size;\nuniform float contrast;\n\nvoid main() {\n\tvec2 pixelCenter = gl_FragCoord.xy / size;\n\tvec2 pixelSize = vec2(1) / size;\n\tvec2 sourcePixelSize = pixelSize * (1.0 / 8.0);\n\tvec2 sourceCellSize = sourcePixelSize * 2.0;\n\n\tvec2 startUV = pixelCenter - pixelSize * 0.5 + sourcePixelSize * 0.5;\n\n\tfloat ao = \t(sumCorners(source, startUV + sourceCellSize * vec2(0, 0), sourcePixelSize) +\n\t\t\t\tsumCorners(source, startUV + sourceCellSize * vec2(1, 0), sourcePixelSize) +\n\t\t\t\tsumCorners(source, startUV + sourceCellSize * vec2(2, 0), sourcePixelSize) +\n\t\t\t\tsumCorners(source, startUV + sourceCellSize * vec2(3, 0), sourcePixelSize) +\n\n\t\t\t\tsumCorners(source, startUV + sourceCellSize * vec2(0, 1), sourcePixelSize) +\n\t\t\t\tsumCorners(source, startUV + sourceCellSize * vec2(1, 1), sourcePixelSize) +\n\t\t\t\tsumCorners(source, startUV + sourceCellSize * vec2(2, 1), sourcePixelSize) +\n\t\t\t\tsumCorners(source, startUV + sourceCellSize * vec2(3, 1), sourcePixelSize) +\n\n\t\t\t\tsumCorners(source, startUV + sourceCellSize * vec2(0, 2), sourcePixelSize) +\n\t\t\t\tsumCorners(source, startUV + sourceCellSize * vec2(1, 2), sourcePixelSize) +\n\t\t\t\tsumCorners(source, startUV + sourceCellSize * vec2(2, 2), sourcePixelSize) +\n\t\t\t\tsumCorners(source, startUV + sourceCellSize * vec2(3, 2), sourcePixelSize) +\n\n\t\t\t\tsumCorners(source, startUV + sourceCellSize * vec2(0, 3), sourcePixelSize) +\n\t\t\t\tsumCorners(source, startUV + sourceCellSize * vec2(1, 3), sourcePixelSize) +\n\t\t\t\tsumCorners(source, startUV + sourceCellSize * vec2(2, 3), sourcePixelSize) +\n\t\t\t\tsumCorners(source, startUV + sourceCellSize * vec2(3, 3), sourcePixelSize)).r / 64.0;\n\n\tgl_FragColor = vec4(pow(ao, contrast), 0, 0, 1);\n}\n"},119:function(e,t){e.exports="precision highp float;\n#define GLSLIFY 1\nattribute vec2 position;\n\nvoid main() {\n\tgl_Position = vec4(position, 0, 1);\n}\n"},120:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),o=r.propBinder(r.regl);t.renderDepth=r.regl({vert:n(121),frag:n(122),attributes:{position:o("positions")},uniforms:{model:o("model"),view:o("view"),projection:o("projection"),nearPlane:o("nearPlane"),farPlane:o("farPlane")},elements:o("indices"),viewport:o("viewport"),framebuffer:o("framebuffer"),cull:{enable:!1,face:"back"}})},121:function(e,t){e.exports="precision highp float;\n#define GLSLIFY 1\nattribute vec3 position;\nuniform mat4 model, view, projection;\nuniform float farPlane, nearPlane;\nvarying float occlusion;\n\nvoid main() {\n\tvec4 cs_position = view * model * vec4(position, 1);\n\tocclusion = 1.0 -  min(((-cs_position.z - nearPlane) / (farPlane - nearPlane)), 1.0);\n\tgl_Position = projection * cs_position;\n}\n"},122:function(e,t){e.exports="precision highp float;\n\nvec4 floatToColor(const float value)\n{\n  const vec4 bitSh = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);\n  const vec4 bitMsk = vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);\n  vec4 res = fract(value * bitSh);\n  res -= res.xxyz * bitMsk;\n  return res;\n}\n\nprecision highp float;\n#define GLSLIFY 1\nvarying float occlusion;\n\nvoid main() {\n\tgl_FragColor = vec4(occlusion);\n}\n"},22:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);!function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(114)),t.fbo=function(e,t){return r.regl.framebuffer({width:e,height:void 0!==t?t:e,colorFormat:"rgba",colorType:"uint8"})},t.getSmallestPOTSize=function(e){for(var t=1;t*t<e;)t*=2;return t}},25:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function c(e){try{s(r.next(e))}catch(e){i(e)}}function l(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(c,l)}s((r=r.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var n,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(o=(o=c.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}};Object.defineProperty(t,"__esModule",{value:!0}),n(26);var i=n(1),c=n(27),l=n(112),s=n(113);!function(){r(this,void 0,void 0,function(){var e,t,r,a,u,v,f,p,m,h,d,S,x,z,g,C,b;return o(this,function(o){switch(o.label){case 0:return[4,Promise.resolve().then(function(){return n(123)})];case 1:return e=o.sent(),t=e.positions.length/3,r=l.createSampleCollection(e,.1),[4,s.renderSamples(e,r.all,{near:.1,far:5,fov:.5*Math.PI,sampleSize:4,contrast:1})];case 2:for(a=o.sent(),f=0;f<a.length;f++)r.all[f].value=a[f];for(u=new Float32Array(t),v=i.vec3.create(),f=0;f<t;f++){for(p=r.perVertex[f],m=p.length,i.vec3.copyFromOffset(v,e.positions,3*f),h=0,d=0,S=[],x=[],C=0;C<m;C++)h=i.vec3.dist(v,p[C].position),d+=h,S.push(h),x.push(p[C].value);for(z=0,g=0,C=0;C<m;C++)b=1-S[C]/d,g+=b,z+=x[C]*b;z/=g,u[f]=1-z}return c.renderModel(e,u),[2]}})})}()},26:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1);r.vec3.UP=r.vec3.fromValues(0,1,0),r.vec3.DOWN=r.vec3.fromValues(0,-1,0),r.vec3.LEFT=r.vec3.fromValues(-1,0,0),r.vec3.RIGHT=r.vec3.fromValues(1,0,0),r.vec3.ONE=r.vec3.fromValues(1,1,1),r.vec3.ZERO=r.vec3.fromValues(0,0,0),r.vec3.copyFromOffset=function(e,t,n){return e[0]=t[n+0],e[1]=t[n+1],e[2]=t[n+2],e}},27:function(e,t,n){"use strict";n.r(t),n.d(t,"renderModel",function(){return a});var r=n(0),o=n(1),i=n(23),c=n.n(i),l=n(24),s=n.n(l);function a(e,t){const n=document.getElementsByTagName("canvas")[0];e.positions=c()(e.positions,{center:[0,-.5,0]});var i=new s.a(n,{onRotate:u,drag:.01});const l=Object(r.regl)({vert:"\n\t\t\tprecision highp float;\n\t\t\tattribute vec3 position;\n\t\t\tattribute vec3 normal;\n\t\t\tattribute float occlusion;\n\t\t\tuniform mat4 model, view, projection;\n\t\t\tvarying float vOcclusion;\n\n\t\t\tvoid main() {\n\t\t\t\tgl_Position = projection * view * model * vec4(position, 1);\n\t\t\t\tvOcclusion = occlusion;\n\t\t\t}\n\t\t",frag:"\n\t\t\tprecision highp float;\n\t\t\tvarying float vOcclusion;\n\n\t\t\tvoid main() {\n\t\t\t\tgl_FragColor = vec4(1.0 * vec3(vOcclusion), 1.0);\n\t\t\t}\n\t\t",attributes:{position:e.positions,occlusion:t},uniforms:{model:r.regl.prop("model"),view:r.regl.prop("view"),projection:r.regl.prop("projection")},viewport:r.regl.prop("viewport"),elements:e.indices,cull:{enable:!0,face:"back"}});let a=32;function u(){n.width=n.clientWidth,n.height=n.clientHeight;const e=i.rotation,t=o.mat4.lookAt([],[0,0,a],[0,0,0],[0,1,0]),c=o.mat4.perspective([],Math.PI/4,n.width/n.height,.1,1e3);r.regl.clear({color:[.3,.3,.3,1],depth:1}),l({model:e,view:t,projection:c,viewport:{x:0,y:0,width:n.width,height:n.height}})}window.addEventListener("wheel",function(e){e.deltaY<0?a*=.9:e.deltaY>0&&(a*=1.1),a=Math.max(2,Math.min(64,a)),u()}),i.spin(15,0)}}},[[25,2,3,1]]]);